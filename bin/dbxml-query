#!/usr/bin/perl

use strict;
use warnings;

use Getopt::Long;
use Histvv::Db;

sub usage { die "Usage: dbxml-query db file.xqy\n"; }

my $usage = <<EOT;
Usage: dbxml-query [-v] db file.xqy
EOT

my %opts = ( verbose => 0, help => 0 );
GetOptions ( \%opts, 'verbose|v', 'help|h') or die $usage;

if ($opts{help}) {
    print $usage;
    exit;
}

my $dbfile = shift || die $usage;
my $xqfile = shift || die $usage;

die "query file '$xqfile' does not exist\n" unless -f $xqfile;

# slurp in query file
my $query;
open F, $xqfile or die $!;
$query .= $_ while <F>;
close F;

my $db = Histvv::Db->new($dbfile, { private => 1 });

print STDERR <<EOT if $opts{verbose};
======================================================================
$query
======================================================================
EOT

my @results = $db->query_all($query);
print "$_\n" for @results;
